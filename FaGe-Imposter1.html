<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-TF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imposter: FaGe Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Styles */
        body {
            font-family: 'Inter', sans-serif;
            /* Kahoot-like dark gradient background */
            background-image: linear-gradient(to br, #4A00E0, #8E2DE2);
        }
        .game-title {
            /* Kahoot often uses a specific, bold, slightly rounded font. Inter is a good sans-serif fallback. */
            font-weight: 800; /* Extra bold */
        }
        .card {
            perspective: 1000px;
            cursor: pointer;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 0.75rem; /* Slightly more rounded like Kahoot cards: rounded-xl */
        }
        .card-front {
            background-color: #00A2FF; /* Kahoot Accent Blue */
            color: white;
        }
        .card-back {
            background-color: #64748b; /* Tailwind: bg-slate-500 - Neutral color for content */
            color: white;
            transform: rotateY(180deg);
        }
        .rules-tooltip, .definition-tooltip {
            min-width: 280px;
        }
        .definition-tooltip {
            bottom: calc(100% + 8px); /* Increased spacing */
            left: 50%;
            transform: translateX(-50%);
            min-width: 180px;
            max-width: 280px; /* Allow wider tooltips */
            z-index: 30;
            padding: 0.75rem; /* p-3 */
            border-radius: 0.5rem; /* rounded-lg */
        }
        .fade-in-out {
            animation: fadeInOut 3s ease-in-out;
        }
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translateY(-20px); }
            10%, 90% { opacity: 1; transform: translateY(0); }
        }

        /* Styling for term text on card to enable hyphenation */
        .term-text-hyphenate {
            hyphens: auto;
            -webkit-hyphens: auto; /* For older WebKit browsers */
            word-break: break-word; /* Fallback for better text wrapping */
            text-align: center;
            line-height: 1.3; /* Adjust line height for multi-line terms */
        }

        /* Kahoot-like button base style */
        .kahoot-button {
            color: white;
            font-weight: 700; /* bold */
            padding-top: 0.875rem; /* py-3.5 */
            padding-bottom: 0.875rem;
            padding-left: 1.5rem; /* px-6 */
            padding-right: 1.5rem;
            border-radius: 0.375rem; /* rounded-md, Kahoot buttons are often less rounded */
            text-lg: ;
            transition: all 0.15s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
        }
        .kahoot-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
        }
        .kahoot-button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5); /* Ring-like effect with white */
        }

        .kahoot-button-green { background-color: #26890C; /* Darker Green */ }
        .kahoot-button-green:hover { background-color: #31AF0F; }
        .kahoot-button-blue { background-color: #1368CE; }
        .kahoot-button-blue:hover { background-color: #1881FF; }
        .kahoot-button-yellow { background-color: #D89E00; }
        .kahoot-button-yellow:hover { background-color: #FFB81C; }
        .kahoot-button-red { background-color: #C92828; }
        .kahoot-button-red:hover { background-color: #E53E3E; }
        .kahoot-button-purple { background-color: #6A1B9A; }
        .kahoot-button-purple:hover { background-color: #8E2DE2; }
        .kahoot-button-slate { background-color: #4A5568; } /* For back button */
        .kahoot-button-slate:hover { background-color: #718096; }


        /* Custom select styling to look more Kahoot-like */
        select.kahoot-select {
            background-color: white;
            border: 2px solid #CBD5E0; /* border-slate-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.75rem 1rem; /* p-3 */
            color: #2D3748; /* text-slate-800 */
            appearance: none; /* Remove default arrow */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%234A5568'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5em 1.5em;
        }
        select.kahoot-select:focus {
            border-color: #4A00E0; /* Kahoot Purple */
            box-shadow: 0 0 0 3px rgba(74, 0, 224, 0.3);
            outline: none;
        }

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
</head>
<body class="text-slate-800 flex flex-col items-center justify-center min-h-screen p-4">

    <div id="game-container" class="bg-white p-8 sm:p-10 md:p-12 rounded-2xl shadow-2xl w-full max-w-xl transition-all duration-500">

        <div id="start-screen">
            <div class="mx-auto mb-6 h-24 w-24 flex items-center justify-center rounded-full bg-gradient-to-br from-purple-600 to-indigo-600 shadow-lg">
                <span class="text-5xl text-white">ü©∫</span>
            </div>
            <h1 class="game-title text-4xl sm:text-5xl font-extrabold text-center mb-2 text-purple-700">Imposter</h1>
            <p class="text-center text-slate-500 mb-8 text-2xl font-medium">FaGe Edition</p>

            <div class="mb-4">
                <label for="semesterSelect" class="block text-sm font-medium text-slate-700 mb-1">Semester ausw√§hlen:</label>
                <select id="semesterSelect" class="kahoot-select w-full text-lg">
                    </select>
            </div>

            <div id="hk-select-container" class="mb-6 hidden">
                <label for="hkSelect" class="block text-sm font-medium text-slate-700 mb-1">Handlungskompetenz ausw√§hlen:</label>
                <select id="hkSelect" class="kahoot-select w-full text-lg">
                    </select>
            </div>

            <button id="startGameBtn" class="kahoot-button kahoot-button-green w-full text-xl">Spiel Starten</button>
        </div>

        <div id="player-setup-screen" class="hidden">
            <h2 class="text-3xl sm:text-4xl font-bold mb-8 text-center text-purple-700">Spieler einrichten</h2>
            <div class="mb-6">
                <label for="playerCount" class="block text-sm font-medium text-slate-700 mb-1">Anzahl Spieler:</label>
                <select id="playerCount" class="kahoot-select w-full text-lg">
                    </select>
            </div>
            <div id="playerNameInputs" class="mb-6 space-y-4">
                </div>
            <div class="flex space-x-3">
                <button id="backToStartBtn" class="kahoot-button kahoot-button-slate w-1/3 text-lg">Zur√ºck</button>
                <button id="submitPlayersBtn" class="kahoot-button kahoot-button-green w-2/3 text-lg">Spiel konfigurieren!</button>
            </div>
        </div>

        <div id="role-reveal-screen" class="hidden">
            <h2 class="text-3xl sm:text-4xl font-bold mb-4 text-center text-purple-700">Rollen aufdecken</h2>
            <p class="text-base text-slate-600 mb-8 text-center">Klicke auf deinen Namen, um deine Rolle zu sehen. Merke sie dir gut und gib das Ger√§t dann weiter.</p>
            <div id="playerCardsContainer" class="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-8">
                </div>
            <button id="proceedToGameBtn" class="kahoot-button kahoot-button-green w-full text-xl hidden">Alle Rollen gesehen? Spiel starten!</button>
        </div>

        <div id="game-screen" class="hidden">
            <h2 class="text-3xl sm:text-4xl font-bold mb-4 text-center text-purple-700">Das Spiel l√§uft!</h2>
            <p id="startingPlayerText" class="text-xl text-center font-semibold text-slate-700 mb-8"></p>
            
            <div class="rules-container relative group mb-8 text-center">
                <button class="bg-purple-100 text-purple-700 px-6 py-3 rounded-lg hover:bg-purple-200 text-base font-medium transition duration-150 focus:outline-none focus:ring-2 focus:ring-purple-400 shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                    </svg>
                    Spielregeln
                </button>
                <div class="rules-tooltip absolute hidden group-hover:block bg-slate-800 text-white text-sm rounded-lg p-4 shadow-xl z-20 mt-2 left-1/2 transform -translate-x-1/2 text-left">
                    <h4 class="font-bold text-base mb-2">Kurzregeln:</h4>
                    <ul class="list-disc list-inside space-y-1">
                        <li>Ein Spieler ist der Imposter (kennt den Begriff nicht).</li>
                        <li>Die anderen kennen den geheimen Fachbegriff.</li>
                        <li>Reihum einen Hinweis geben (1 Wort/kurze Phrase).</li>
                        <li>Begriff NICHT direkt nennen!</li>
                        <li>Crew gewinnt: Imposter wird entlarvt.</li>
                        <li>Imposter gewinnt: Begriff wird erraten ODER ein Unschuldiger f√§lschlich beschuldigt.</li>
                        <li>Nach jeder Runde: Diskutieren & abstimmen.</li>
                    </ul>
                </div>
            </div>

            <p class="text-slate-600 text-base mb-6 text-center">Viel Spa√ü beim Diskutieren, Kombinieren und Entlarven!</p>
            
            <button id="revealBtn" class="kahoot-button kahoot-button-yellow w-full text-xl mb-4">Aufl√∂sen</button>
            
            <div id="reveal-info" class="hidden my-6 p-6 bg-indigo-50 rounded-xl shadow text-center">
                <h3 class="text-2xl font-semibold text-indigo-700 mb-3">Aufl√∂sung</h3>
                <p id="imposterWasText" class="text-xl text-slate-700"></p>
                <p id="wordWasText" class="text-xl text-slate-700 mt-2"></p>
            </div>
            
            <button id="replaySamePlayersBtn" class="kahoot-button kahoot-button-blue w-full text-xl mb-4 hidden">Nochmal Spielen (Gleiche Spieler)</button>

            <button id="newGameBtn" class="kahoot-button kahoot-button-purple w-full text-xl">Neues Spiel</button>
        </div>

        <div id="message-box" class="fixed top-6 right-6 bg-red-600 text-white p-4 rounded-lg shadow-xl hidden z-50 max-w-md text-base">
            <p id="message-text"></p>
        </div>
    </div>

    <script>
        // DOM Elements
        const screens = {
            start: document.getElementById('start-screen'),
            playerSetup: document.getElementById('player-setup-screen'),
            roleReveal: document.getElementById('role-reveal-screen'),
            game: document.getElementById('game-screen'),
        };
        const startGameBtn = document.getElementById('startGameBtn');
        const semesterSelect = document.getElementById('semesterSelect');
        const hkSelectContainer = document.getElementById('hk-select-container');
        const hkSelect = document.getElementById('hkSelect');
        const playerCountSelect = document.getElementById('playerCount');
        const playerNameInputsContainer = document.getElementById('playerNameInputs');
        const submitPlayersBtn = document.getElementById('submitPlayersBtn');
        const backToStartBtn = document.getElementById('backToStartBtn');
        const playerCardsContainer = document.getElementById('playerCardsContainer');
        const proceedToGameBtn = document.getElementById('proceedToGameBtn');
        const startingPlayerText = document.getElementById('startingPlayerText');
        const newGameBtn = document.getElementById('newGameBtn');
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');
        const revealBtn = document.getElementById('revealBtn');
        const revealInfoDiv = document.getElementById('reveal-info');
        const imposterWasText = document.getElementById('imposterWasText');
        const wordWasText = document.getElementById('wordWasText');
        const replaySamePlayersBtn = document.getElementById('replaySamePlayersBtn'); // New button

        // Game State
        let players = []; // Stores objects like { name: "Spieler1", isImposter: false, roleRevealed: false }
        let playerNamesForReplay = []; // Stores just the names for replay
        let currentWord = { term: '', definition: '' };
        let imposterIndex = -1;
        let rolesRevealedCount = 0;
        let currentTermsList = [];

        // Begriff-Datenbank nach Semestern und Handlungskompetenzen (HK)
        // WICHTIG: Dies ist nur eine BEISPIELHAFTE Auswahl. Bitte mit allen Begriffen und Definitionen f√ºllen!
        const termsBySemester = {
            "Semester 1": {
                "HK A1: Umsetzung von Professionalit√§t und Klientenzentrierung - Berufsperson": [
                    { term: "Instruktion", definition: "Gezielte Anleitung und Unterweisung." },
                    { term: "Reflexion", definition: "Systematisches Nachdenken √ºber Erfahrungen und Handlungen." },
                    { term: "Datenschutz", definition: "Schutz personenbezogener Daten vor Missbrauch." },
                    { term: "Florence Nightingale", definition: "Britische Krankenschwester, Pionierin der modernen Krankenpflege." },
                    { term: "Henry Dunant", definition: "Schweizer Gesch√§ftsmann, Gr√ºnder des Roten Kreuzes." },
                ],
                "HK A2: Umsetzung von Professionalit√§t und Klientenzentrierung - Kommunikation": [
                    { term: "4-Ohren-Modell", definition: "Kommunikationsmodell (Sach-, Selbstoffenbarungs-, Beziehungs-, Appell-Ohr)." },
                    { term: "Aktives Zuh√∂ren", definition: "Aufmerksames Zuh√∂ren mit verbalen und nonverbalen Signalen." },
                    { term: "Paraphrasieren", definition: "Wiedergeben des Geh√∂rten in eigenen Worten zur Verst√§ndnissicherung." },
                ],
                "HK B1: Pflege und Betreuung - K√∂rperpflege": [
                    { term: "Hautturgor", definition: "Spannungszustand der Haut, Indikator f√ºr Fl√ºssigkeitshaushalt." },
                    { term: "Intertrigoprophylaxe", definition: "Vorbeugung von Hautsch√§den in Hautfalten (z.B. durch Reibung, Feuchtigkeit)." },
                    { term: "Diffusion", definition: "Selbstst√§ndige Vermischung von Teilchen aufgrund ihrer Eigenbewegung." },
                    { term: "Professionelle Ber√ºhrung", definition: "Zielgerichtete, respektvolle Ber√ºhrung im Pflegekontext." },
                ],
                 "HK B2: Pflege und Betreuung - Mobilit√§t": [
                    { term: "Passiver Bewegungsapparat", definition: "Knochen, Gelenke, B√§nder, Knorpel; st√ºtzt und erm√∂glicht Bewegung." },
                    { term: "Sturzprophylaxe", definition: "Ma√ünahmen zur Vorbeugung von St√ºrzen bei gef√§hrdeten Personen." },
                    { term: "Quergestreifte Muskulatur", definition: "Skelettmuskulatur, willk√ºrlich steuerbar." },
                ],
                "HK B5: Pflege und Betreuung - Ern√§hrung": [
                    { term: "Peristaltik", definition: "Wellenf√∂rmige Muskelkontraktion zur Fortbewegung von Nahrung im Verdauungstrakt." },
                    { term: "Aspirationsprophylaxe", definition: "Ma√ünahmen zur Vermeidung des Einatmens von Fremdstoffen in die Atemwege." },
                    { term: "Dehydrationsprophylaxe", definition: "Ma√ünahmen zur Vorbeugung von Fl√ºssigkeitsmangel." },
                ],
                "HK E1: F√∂rdern und Erhalten von Gesundheit und Hygiene - Hygienemassnahmen": [
                    { term: "Nosokomiale Infektion", definition: "Im Krankenhaus oder einer Pflegeeinrichtung erworbene Infektion." },
                    { term: "Infektionskette", definition: "Weg eines Erregers vom Wirt zur Infektion eines neuen Wirts (Quelle, √úbertragungsweg, Empf√§nger)." },
                    { term: "Desinfektion und Sterilisation", definition: "Verfahren zur Keimreduktion bzw. Keimfreiheit." },
                ],
                "HK G1: Wahrnehmen hauswirtschaftlicher Aufgaben - Kleidung": [
                    { term: "W√§schekreislauf", definition: "Prozess von schmutziger zu sauberer W√§sche inkl. Sortieren, Waschen, Trocknen, etc." },
                    { term: "Textilkunde", definition: "Lehre von den Eigenschaften und der Verarbeitung von Textilien." },
                ],
                "HK G2: Wahrnehmen hauswirtschaftlicher Aufgaben - Sauberes Umfeld": [
                    { term: "K√ºchenhygiene", definition: "Ma√ünahmen zur Sauberkeit und Vermeidung von Keim√ºbertragung in der K√ºche." },
                    { term: "Ergonomie", definition: "Anpassung der Arbeitsbedingungen an den Menschen zur Gesundheitsf√∂rderung." },
                ],
                "HK H2: Durchf√ºhren administrativer und logistischer Aufgaben - Informations- und Kommunikationstechnologien": [
                    { term: "E-Health-Strategie", definition: "Einsatz digitaler Technologien zur Unterst√ºtzung und Verbesserung des Gesundheitswesens." },
                    { term: "Cybermobbing", definition: "Bel√§stigung, Bedrohung oder Blo√üstellung anderer √ºber digitale Medien." },
                ],
                "HK H4: Durchf√ºhren administrativer und logistischer Aufgaben - Verbandsmaterial und Medikamente bewirtschaften": [
                    { term: "First-in-First-out", definition: "Lagerprinzip: Zuerst eingelagerte Ware wird zuerst entnommen, um Verfall zu vermeiden." },
                    { term: "Bet√§ubungsmittelgesetz", definition: "Gesetzliche Regelung zum Umgang mit Bet√§ubungsmitteln." },
                ],
                "HK H5: Durchf√ºhren administrativer und logistischer Aufgaben - Apparate und Mobiliar unterhalten": [
                    { term: "Wartung", definition: "Regelm√§√üige √úberpr√ºfung und Instandhaltung von Ger√§ten und Mobiliar zur Funktionssicherung." },
                ],
            },
            "Semester 2": {
                "HK A2: Umsetzung von Professionalit√§t und Klientenzentrierung - Kommunikation": [
                    { term: "Transaktionsanalyse", definition: "Theorie der menschlichen Pers√∂nlichkeit und Kommunikation (Ich-Zust√§nde: Eltern-Ich, Erwachsenen-Ich, Kind-Ich)." },
                ],
                "HK A3: Umsetzung von Professionalit√§t und Klientenzentrierung - Beobachtungen": [
                    { term: "Orientierungsst√∂rung", definition: "Beeintr√§chtigung der Orientierung zu Zeit, Ort, Person oder Situation." },
                    { term: "Wahrnehmungsst√∂rung", definition: "Ver√§nderte oder gest√∂rte Aufnahme und Verarbeitung von Sinnesreizen." },
                ],
                 "HK B1: Pflege und Betreuung - K√∂rperpflege": [
                    { term: "Psoriasis", definition: "Schuppenflechte, chronisch-entz√ºndliche Hauterkrankung mit starker Schuppung." },
                    { term: "Glaukom", definition: "Gr√ºner Star, Gruppe von Augenerkrankungen mit Sch√§digung des Sehnervs, oft durch erh√∂hten Augeninnendruck." },
                    { term: "Soor", definition: "Pilzinfektion (meist Candida albicans) der Haut oder Schleimh√§ute." },
                ],
                "HK B2: Pflege und Betreuung - Mobilit√§t": [
                    { term: "Arthrose", definition: "Degenerative Gelenkerkrankung, Gelenkverschlei√ü mit Knorpelabbau." },
                    { term: "Osteoporose", definition: "Knochenschwund, verringerte Knochendichte und -festigkeit, erh√∂htes Frakturrisiko." },
                    { term: "Kontrakturen", definition: "Dauerhafte Verk√ºrzung von Muskeln, Sehnen, B√§ndern mit Bewegungseinschr√§nkung eines Gelenks." },
                ],
                "HK B3: Pflege und Betreuung - Ausscheidung": [
                    { term: "Urininkontinenz", definition: "Unfreiwilliger Verlust von Urin." },
                    { term: "Stressinkontinenz", definition: "Urinverlust bei k√∂rperlicher Belastung (Husten, Niesen, Heben)." },
                ],
                "HK D1: Ausf√ºhren von medizinaltechnischen Verrichtungen - Vitalzeichen kontrollieren": [
                    { term: "Hypertonie", definition: "Bluthochdruck, dauerhaft erh√∂hter Blutdruck (systolisch >140 mmHg / diastolisch >90 mmHg)." },
                    { term: "Bradykardie", definition: "Verlangsamter Herzschlag, Pulsfrequenz unter 60 Schl√§gen pro Minute." },
                    { term: "Hypoxie", definition: "Sauerstoffmangel im Gewebe." },
                ],
                "HK E1: F√∂rdern und erhalten von Gesundheit und Hygiene - Arbeitssicherheit": [
                     { term: "Ergonomie", definition: "Anpassung der Arbeitsbedingungen und -mittel an den Menschen zur Vermeidung von Belastungen." },
                     { term: "Psychohygiene", definition: "Ma√ünahmen zur Erhaltung und F√∂rderung der seelischen Gesundheit." },
                ],
                "HK E3: F√∂rdern und erhalten von Gesundheit und Hygiene - Nervensystem, Apoplexie": [
                    { term: "Apoplexie", definition: "Schlaganfall, pl√∂tzliche Durchblutungsst√∂rung im Gehirn mit neurologischen Ausf√§llen." },
                    { term: "FAST-Test", definition: "Schnelltest zur Erkennung eines Schlaganfalls (Face, Arms, Speech, Time)." },
                ],
                "HK E4: F√∂rdern und erhalten von Gesundheit und Hygiene - Ern√§hrung": [
                    { term: "Kohlenhydrate", definition: "Makron√§hrstoffe, die dem K√∂rper Energie liefern (z.B. Zucker, St√§rke, Ballaststoffe)." },
                    { term: "Body-Mass-Index (BMI)", definition: "Ma√üzahl zur Bewertung des K√∂rpergewichts in Relation zur K√∂rpergr√∂√üe (kg/m¬≤)." },
                ],
                "HK F1: Gestalten des Alltags - Alltag gestalten": [
                    { term: "Partizipation", definition: "Teilhabe und Mitbestimmung von Klienten an Entscheidungen, die sie betreffen." },
                    { term: "Aktivit√§ten des t√§glichen Lebens", definition: "Grundlegende Verrichtungen wie K√∂rperpflege, Essen, Mobilit√§t (ATL)." },
                ],
                "HK F2: Gestalten des Alltags - Aufbau und Einhalten der Tagesstruktur": [
                    { term: "Milieutherapie", definition: "Gestaltung der Umgebung und des sozialen Umfelds zur therapeutischen Unterst√ºtzung." },
                    { term: "Depression", definition: "Psychische Erkrankung mit gedr√ºckter Stimmung, Interessenverlust und Antriebslosigkeit." },
                ],
                "HK H1: Durchf√ºhren administrativer und logistischer Aufgaben - Ein- und Austritte": [
                    { term: "Relokationssyndrom", definition: "Stressreaktion bei Verlegung oder Umzug von (meist √§lteren) Klienten in eine neue Umgebung." },
                ]
            },
            "Semester 3": {
                "HK A1: Umsetzung von Professionalit√§t und Klientenzentrierung - Planung": [
                    { term: "Bezugspflege (Primary Nursing)", definition: "Pflegesystem, bei dem eine Pflegeperson kontinuierlich f√ºr die gesamte Pflege einer kleinen Patientengruppe zust√§ndig ist." },
                    { term: "Eisenhower-Prinzip", definition: "Zeitmanagement-Methode zur Priorisierung von Aufgaben nach Wichtigkeit und Dringlichkeit." },
                ],
                "HK A2: Umsetzung von Professionalit√§t und Klientenzentrierung - Konflikte": [
                    { term: "Deeskalation", definition: "Ma√ünahmen zur Reduzierung von Spannung und Verhinderung der Zuspitzung eines Konflikts." },
                ],
                "HK A4: Umsetzung von Professionalit√§t und Klientenzentrierung - Biografie und Religion": [
                    { term: "Biografiearbeit", definition: "Auseinandersetzung mit der Lebensgeschichte eines Menschen zur individuellen und verst√§ndnisvollen Pflege." },
                    { term: "Generationenarbeit", definition: "Aktivit√§ten und Ans√§tze, die den Austausch und das Verst√§ndnis zwischen verschiedenen Generationen f√∂rdern." },
                ],
                "HK B3: Pflege und Betreuung - Ausscheidung": [
                    { term: "Niereninsuffizienz", definition: "Ungen√ºgende Funktion der Nieren, Abfallstoffe und Fl√ºssigkeit ausreichend auszuscheiden." },
                    { term: "Obstipationsprophylaxe", definition: "Ma√ünahmen zur Vorbeugung von Verstopfung (z.B. ballaststoffreiche Ern√§hrung, Bewegung, ausreichend Trinken)." },
                    { term: "Zystitisprophylaxe", definition: "Ma√ünahmen zur Vorbeugung von Blasenentz√ºndungen." },
                ],
                "HK B4: Pflege und Betreuung - Atmung": [
                    { term: "Dyspnoe", definition: "Atemnot, subjektiv empfundene Erschwerung der Atmung." },
                    { term: "Sputum", definition: "Auswurf aus den Atemwegen (Schleim, Sekret)." },
                ],
                "HK B6: Pflege und Betreuung - Ruhen und Schlafen": [
                    { term: "REM-Phase", definition: "Schlafphase mit schnellen Augenbewegungen (Rapid Eye Movement), in der intensiv getr√§umt wird." },
                    { term: "Schlafhygiene", definition: "Verhaltensweisen und Gewohnheiten, die einen gesunden und erholsamen Schlaf f√∂rdern." },
                ],
                "HK D2: Ausf√ºhren von medizinaltechnischen Verrichtungen - Ven√∂se und kapill√§re Venenpunktion": [
                    { term: "Antikoagulantien", definition: "Medikamente zur Hemmung der Blutgerinnung (Blutverd√ºnner)." },
                    { term: "H√§mostase", definition: "Prozess der Blutstillung nach einer Verletzung." },
                ],
                "HK D3: Ausf√ºhren von medizinaltechnischen Verrichtungen - Medikamente richten und verabreichen": [
                    { term: "6-R-Regel", definition: "Sicherheitsregel bei der Medikamentenverabreichung (Richtig: Patient, Medikament, Dosis, Applikationsform, Zeit, Dokumentation)." },
                    { term: "Pharmakokinetik", definition: "Lehre davon, was der K√∂rper mit einem Medikament macht (Resorption, Verteilung, Metabolismus, Elimination)." },
                ],
                "HK D6: Ausf√ºhren von medizinaltechnischen Verrichtungen - s.c. und i.m. Injektionen": [
                    { term: "Hypoglyk√§mie", definition: "Unterzuckerung, zu niedriger Blutzuckerspiegel." },
                    { term: "Insulin", definition: "Hormon, das den Blutzuckerspiegel senkt und in der Bauchspeicheldr√ºse produziert wird." },
                    { term: "Metabolisches Syndrom", definition: "Kombination verschiedener Risikofaktoren f√ºr Herz-Kreislauf-Erkrankungen (z.B. √úbergewicht, Bluthochdruck, erh√∂hter Blutzucker)." },
                ],
                "HK E1: F√∂rdern und erhalten von Gesundheit und Hygiene - Immunsystem und Infektionskrankheiten": [
                    { term: "Antigen", definition: "Substanz, die eine spezifische Immunantwort im K√∂rper ausl√∂st (z.B. Bildung von Antik√∂rpern)." },
                    { term: "Immunisierung", definition: "Herbeif√ºhrung von Unempf√§nglichkeit gegen√ºber einem Krankheitserreger (aktiv oder passiv)." },
                ],
                "HK E2: F√∂rdern und erhalten von Gesundheit und Hygiene - Isolation": [
                    { term: "Kontaktisolierung", definition: "Isolationsma√ünahme bei √úbertragung von Krankheitserregern durch direkten oder indirekten Kontakt." },
                    { term: "Salutogenese", definition: "Modell der Gesundheitsentstehung und -erhaltung (Fokus auf Ressourcen und Schutzfaktoren)." },
                ],
                "HK E3: F√∂rdern und erhalten von Gesundheit und Hygiene - Morbus Parkinson, Multiple Sklerose": [
                    { term: "Multiple Sklerose (MS)", definition: "Chronisch-entz√ºndliche Autoimmunerkrankung des zentralen Nervensystems, die die Myelinscheiden sch√§digt." },
                    { term: "Morbus Parkinson", definition: "Neurodegenerative Erkrankung mit Dopaminmangel, f√ºhrt zu Bewegungsst√∂rungen (Tremor, Rigor, Akinese)." },
                ],
                "HK F1: Gestalten des Alltags - Alltag gestalten": [
                     { term: "Rituale", definition: "Regelm√§√üig wiederkehrende Handlungen mit symbolischer Bedeutung, die Struktur und Sicherheit im Alltag geben k√∂nnen." },
                ],
                "HK H3: Durchf√ºhren administrativer und logistischer Aufgaben - Transporte": [
                    { term: "Rotkreuzfahrzeuge", definition: "Fahrzeuge des Roten Kreuzes, die f√ºr Krankentransporte und im Rettungsdienst eingesetzt werden." },
                ]
            },
             "Semester 4": {
                "HK A4: Umsetzung von Professionalit√§t und Klientenzentrierung - Transkulturelle Pflege": [
                    { term: "Transkulturelle Pflege", definition: "Pflege, die kulturelle Unterschiede, Werte und Bed√ºrfnisse von Klienten ber√ºcksichtigt und respektiert." },
                    { term: "Migration", definition: "Dauerhafter Wechsel des Wohnsitzes √ºber Staatsgrenzen hinweg." },
                ],
                "HK A5: Umsetzung von Professionalit√§t und Klientenzentrierung - Qualit√§tssicherung": [
                    { term: "Pflegeprozess", definition: "Systematischer Probleml√∂sungsansatz in der Pflege (Informationssammlung, Diagnose, Zielsetzung, Planung, Durchf√ºhrung, Evaluation)." },
                    { term: "Fehlermanagement", definition: "Systematischer Umgang mit Fehlern zur Verbesserung der Sicherheit und Qualit√§t." },
                ],
                "HK B4: Pflege und Betreuung - Atmung": [
                    { term: "Pneumonie", definition: "Lungenentz√ºndung, eine Infektion des Lungengewebes." },
                    { term: "COPD (Chronisch obstruktive Lungenerkrankung)", definition: "Chronische Lungenerkrankung mit Verengung der Atemwege und oft Lungenemphysem." },
                    { term: "Aerosol", definition: "Feinste Verteilung fester oder fl√ºssiger Stoffe in einem Gas (z.B. zur Inhalation von Medikamenten)." },
                ],
                "HK B6: Pflege und Betreuung - Ruhen und Schlafen": [
                     { term: "Somnolenz", definition: "Abnorme Schl√§frigkeit, Benommenheit; der Patient ist leicht weckbar." },
                     { term: "Hypnotika", definition: "Schlafmittel, Medikamente zur F√∂rderung des Schlafes." },
                ],
                "HK C2: Pflege und Betreuung in anspruchsvollen Situationen - Onkologie und Schmerzen": [
                    { term: "WHO-Stufenplan", definition: "Schema der Weltgesundheitsorganisation zur medikament√∂sen Schmerztherapie in drei Stufen." },
                    { term: "Metastasen", definition: "Tochtergeschw√ºlste eines b√∂sartigen Tumors, die sich in anderen K√∂rperregionen ansiedeln." },
                    { term: "Chemotherapie", definition: "Medikament√∂se Behandlung von Krebserkrankungen mit Zytostatika." },
                ],
                "HK C3: Pflege und Betreuung in anspruchsvollen Situationen - Krisensituation": [
                    { term: "Copingstrategien", definition: "Bew√§ltigungsmechanismen und Verhaltensweisen im Umgang mit Stress, Belastungen und Krisen." },
                    { term: "Suizidalit√§t", definition: "Gef√§hrdung durch Selbstt√∂tungsgedanken, -absichten oder -handlungen." },
                ],
                "HK C4: Pflege und Betreuung in anspruchsvollen Situationen - Chronische Krankheiten": [
                    { term: "Adh√§renz", definition: "Einhaltung der gemeinsam von Klient und Fachperson vereinbarten Therapieziele und -ma√ünahmen." },
                    { term: "Multimorbidit√§t", definition: "Gleichzeitiges Bestehen mehrerer chronischer Erkrankungen bei einer Person." },
                ],
                "HK C5: Pflege und Betreuung in anspruchsvollen Situationen - Verwirrtheitszust√§nden": [
                    { term: "Demenz", definition: "Fortschreitender Verlust kognitiver F√§higkeiten (Ged√§chtnis, Orientierung, Sprache, Denken)." },
                    { term: "Validation", definition: "Kommunikationsmethode f√ºr Menschen mit Demenz, die ihre subjektive Realit√§t und Gef√ºhlswelt anerkennt und best√§tigt." },
                    { term: "Delir", definition: "Akuter Verwirrtheitszustand mit Bewusstseins-, Aufmerksamkeits- und Wahrnehmungsst√∂rungen." },
                ],
                "HK D4: Ausf√ºhren von medizinaltechnischen Verrichtungen - Infusionen richten f√ºr den bestehenden peripher ven√∂sem Zugang": [
                    { term: "Phlebitis", definition: "Venenentz√ºndung, oft als Komplikation bei ven√∂sen Zug√§ngen (z.B. Infusionen)." },
                    { term: "Isotonische L√∂sung", definition: "L√∂sung mit dem gleichen osmotischen Druck wie das Blutplasma." },
                ],
                "HK D5: Ausf√ºhren von medizinaltechnischen Verrichtungen - Sondennahrung": [
                    { term: "PEG-Sonde (Perkutane endoskopische Gastrostomie)", definition: "Ern√§hrungssonde, die durch die Bauchwand direkt in den Magen gelegt wird." },
                    { term: "Enteral", definition: "Verabreichung von Nahrung oder Medikamenten √ºber den Magen-Darm-Trakt." },
                ],
                "HK D7: Ausf√ºhren von medizinaltechnischen Verrichtungen - Wundmanagement": [
                    { term: "Dekubitus", definition: "Druckgeschw√ºr, eine Sch√§digung der Haut und des darunterliegenden Gewebes durch langanhaltenden Druck." },
                    { term: "Nekrose", definition: "Abgestorbenes Gewebe." },
                    { term: "Exsudat", definition: "Fl√ºssigkeitsaustritt aus Gef√§√üen bei Entz√ºndungen oder Wunden." },
                ],
                "HK E2: F√∂rdern und erhalten von Gesundheit und Hygiene - Impfen, Influenza": [
                    { term: "Influenza", definition: "Echte Grippe, eine akute, fieberhafte Viruserkrankung der Atemwege." },
                    { term: "Aktive Impfung", definition: "Impfung mit abgeschw√§chten oder abget√∂teten Erregern (oder deren Teilen) zur Anregung der k√∂rpereigenen Immunantwort." },
                ],
                "HK E4: F√∂rdern und erhalten von Gesundheit und Hygiene - Ern√§hrung beraten": [
                    { term: "Body-Mass-Index (BMI)", definition: "Ma√üzahl zur Bewertung des K√∂rpergewichts in Relation zur K√∂rpergr√∂√üe (kg/m¬≤)." },
                    { term: "Lebensmittelpyramide", definition: "Grafische Darstellung von Empfehlungen f√ºr eine ausgewogene Ern√§hrung." },
                ],
                "HK F3: Gestalten des Alltags - Sexualit√§t": [
                    { term: "Sexuelle Orientierung", definition: "Emotionale, romantische und/oder sexuelle Anziehung zu anderen Personen (z.B. hetero-, homo-, bisexuell)." },
                    { term: "Prim√§re Geschlechtsmerkmale", definition: "Angeborene Geschlechtsorgane (z.B. Penis, Hoden bzw. Vagina, Ovarien)." },
                ]
            },
            "Semester 5": {
                "HK A5: Umsetzung von Professionalit√§t und Klientenzentrierung - Leitungserfassung": [
                    { term: "SwissDRG", definition: "Fallpauschalensystem zur Abrechnung von station√§ren Krankenhausleistungen in der Schweiz." },
                    { term: "LEP (Leistungserfassung Pflege)", definition: "System zur Erfassung und Dokumentation von Pflegeleistungen." },
                ],
                "HK C1: Pflege und Betreuung in anspruchsvollen Situationen - Notfallsituationen": [
                    { term: "Reanimation", definition: "Wiederbelebungsma√ünahmen bei Herz-Kreislauf-Stillstand (Herzdruckmassage, Beatmung)." },
                    { term: "Hypovol√§mischer Schock", definition: "Lebensbedrohlicher Zustand durch massiven Fl√ºssigkeits- oder Blutverlust." },
                    { term: "Defibrillator", definition: "Ger√§t zur Behandlung von Herzrhythmusst√∂rungen durch elektrische Impulse." },
                ],
                "HK C2: Pflege und Betreuung in anspruchsvollen Situationen - Sterbephasen": [
                    { term: "Sterbephasen (nach K√ºbler-Ross)", definition: "Modell zur Beschreibung emotionaler Reaktionen im Sterbeprozess (Leugnen, Zorn, Verhandeln, Depression, Akzeptanz)." },
                    { term: "Patientenverf√ºgung", definition: "Schriftliche Willenserkl√§rung f√ºr medizinische Behandlungen im Falle eigener Entscheidungsunf√§higkeit." },
                ],
                "HK C3: Pflege und Betreuung in anspruchsvollen Situationen - Abh√§ngigkeit": [
                    { term: "Entzugssyndrom", definition: "K√∂rperliche und psychische Symptome, die beim Absetzen oder Reduzieren einer suchterzeugenden Substanz auftreten." },
                    { term: "Substanzgebundene Abh√§ngigkeit", definition: "Sucht nach psychoaktiven Substanzen (z.B. Alkohol, Drogen, Medikamente)." },
                ],
                "HK C4: Pflege und Betreuung in anspruchsvollen Situationen - Palliative Situation": [
                    { term: "Palliative Care", definition: "Umfassende Betreuung zur Verbesserung der Lebensqualit√§t von Patienten und ihren Familien bei unheilbaren, fortschreitenden Krankheiten." },
                    { term: "Symptommanagement", definition: "Systematische Erfassung und Behandlung belastender Symptome in der Palliative Care." },
                ],
                "HK F3: Gestalten des Alltags - Sexuell √ºbertragbare Krankheiten": [
                    { term: "HI-Viren (HIV)", definition: "Humanes Immundefizienz-Virus, Erreger der Immunschw√§chekrankheit AIDS." },
                    { term: "Chlamydien", definition: "Bakterien, die sexuell √ºbertragbare Infektionen im Urogenitalbereich verursachen k√∂nnen." },
                ]
            }
        };

        // Utility Functions
        function showScreen(screenName) {
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            if (screens[screenName]) {
                screens[screenName].classList.remove('hidden');
            }
            if (screenName === 'game') {
                revealInfoDiv.classList.add('hidden');
                revealBtn.classList.remove('hidden'); // Show reveal button when game screen loads
                replaySamePlayersBtn.classList.add('hidden'); // Hide replay button initially
            }
        }

        function showMessage(message, duration = 3000) {
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
            messageBox.classList.add('fade-in-out');
            setTimeout(() => {
                messageBox.classList.add('hidden');
                messageBox.classList.remove('fade-in-out');
            }, duration);
        }

        function populateSemesterSelect() {
            semesterSelect.innerHTML = '';
            const defaultOption = document.createElement('option');
            defaultOption.value = "Zufall";
            defaultOption.textContent = "Zufall (Alle Semester)";
            semesterSelect.appendChild(defaultOption);

            Object.keys(termsBySemester).forEach(semesterKey => {
                const option = document.createElement('option');
                option.value = semesterKey;
                option.textContent = semesterKey;
                semesterSelect.appendChild(option);
            });
            populateHkSelect(semesterSelect.value);
        }

        function populateHkSelect(selectedSemester) {
            hkSelect.innerHTML = '';
            if (selectedSemester === "Zufall" || !termsBySemester[selectedSemester]) {
                hkSelectContainer.classList.add('hidden');
                return;
            }

            hkSelectContainer.classList.remove('hidden');

            const allHkOption = document.createElement('option');
            allHkOption.value = "Alle_HKs";
            allHkOption.textContent = "Alle HKs dieses Semesters";
            hkSelect.appendChild(allHkOption);

            const semesterData = termsBySemester[selectedSemester];
            Object.keys(semesterData).forEach(hkKey => {
                const option = document.createElement('option');
                option.value = hkKey;
                option.textContent = hkKey;
                hkSelect.appendChild(option);
            });
        }


        // Event Listeners
        semesterSelect.addEventListener('change', (event) => {
            populateHkSelect(event.target.value);
        });

        startGameBtn.addEventListener('click', () => {
            const selectedSemesterValue = semesterSelect.value;
            const selectedHkValue = hkSelect.value;
            currentTermsList = [];

            if (selectedSemesterValue === "Zufall") {
                Object.values(termsBySemester).forEach(semesterHks => {
                    Object.values(semesterHks).forEach(hkTerms => {
                        currentTermsList.push(...hkTerms);
                    });
                });
            } else if (termsBySemester[selectedSemesterValue]) {
                const semesterHks = termsBySemester[selectedSemesterValue];
                if (!hkSelectContainer.classList.contains('hidden') && selectedHkValue === "Alle_HKs") {
                     Object.values(semesterHks).forEach(hkTerms => {
                        currentTermsList.push(...hkTerms);
                    });
                } else if (!hkSelectContainer.classList.contains('hidden') && semesterHks[selectedHkValue]) {
                    currentTermsList = [...semesterHks[selectedHkValue]];
                } else { 
                     Object.values(semesterHks).forEach(hkTerms => {
                        currentTermsList.push(...hkTerms);
                    });
                }
            }

            if (currentTermsList.length === 0) {
                showMessage("Keine Begriffe f√ºr die Auswahl gefunden. Bitte die Begriffsliste im Code pr√ºfen oder eine andere Auswahl treffen.");
                return;
            }
            playerNamesForReplay = []; // Clear player names for a completely new game
            showScreen('playerSetup');
            populatePlayerCountSelect();
            updatePlayerNameInputs(); 
        });

        backToStartBtn.addEventListener('click', () => {
            showScreen('start');
            hkSelectContainer.classList.add('hidden');
            hkSelect.innerHTML = '';
        });

        playerCountSelect.addEventListener('change', updatePlayerNameInputs);

        submitPlayersBtn.addEventListener('click', () => {
            const numPlayers = parseInt(playerCountSelect.value);
            const names = [];
            let allNamesFilled = true;
            for (let i = 0; i < numPlayers; i++) {
                const input = document.getElementById(`playerName${i}`);
                if (input.value.trim() === '') {
                    allNamesFilled = false;
                    break;
                }
                names.push(input.value.trim());
            }

            if (!allNamesFilled) {
                showMessage("Bitte gib allen Spielern einen Namen.");
                return;
            }
            if (new Set(names).size !== names.length) {
                 showMessage("Spielernamen m√ºssen eindeutig sein.");
                 return;
            }
            playerNamesForReplay = [...names]; // Store names for potential replay
            initializeGameWithCurrentPlayers(); // Use current players for the first round
            showScreen('roleReveal');
            displayPlayerCards();
        });
        
        replaySamePlayersBtn.addEventListener('click', () => {
            if (playerNamesForReplay.length > 0) {
                // Hide reveal info and replay button, show reveal button again for next round
                revealInfoDiv.classList.add('hidden');
                replaySamePlayersBtn.classList.add('hidden');
                revealBtn.classList.remove('hidden');

                initializeGameWithCurrentPlayers(); // Re-initialize with same players
                showScreen('roleReveal');
                displayPlayerCards();
            } else {
                showMessage("Fehler: Keine Spielerdaten f√ºr 'Nochmal spielen' gefunden.");
                resetGame();
                showScreen('start');
            }
        });


        proceedToGameBtn.addEventListener('click', () => {
            showScreen('game');
            determineStartingPlayer();
        });

        newGameBtn.addEventListener('click', () => {
            resetGame();
            showScreen('start');
        });

        revealBtn.addEventListener('click', () => {
            if (players.length > 0 && imposterIndex !== -1 && currentWord.term !== '') {
                const imposterPlayer = players[imposterIndex];
                imposterWasText.textContent = `Der Imposter war: ${imposterPlayer.name}`;
                wordWasText.textContent = `Der gesuchte Begriff war: ${currentWord.term}`;
                revealInfoDiv.classList.remove('hidden');
                revealBtn.classList.add('hidden');
                replaySamePlayersBtn.classList.remove('hidden'); // Show replay button
            } else {
                showMessage("Das Spiel muss zuerst vollst√§ndig konfiguriert sein, um aufzul√∂sen.");
            }
        });

        // Game Logic Functions
        function populatePlayerCountSelect() {
            playerCountSelect.innerHTML = ''; 
            for (let i = 2; i <= 8; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i} Spieler`;
                playerCountSelect.appendChild(option);
            }
            playerCountSelect.value = Math.min(8, Math.max(2, playerNamesForReplay.length > 0 ? playerNamesForReplay.length : 4)).toString();
        }

        function updatePlayerNameInputs() {
            const numPlayers = parseInt(playerCountSelect.value);
            playerNameInputsContainer.innerHTML = ''; 
            for (let i = 0; i < numPlayers; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `playerName${i}`;
                input.value = playerNamesForReplay[i] || '';
                input.placeholder = `Name Spieler ${i + 1}`;
                input.className = 'w-full p-3 border border-slate-300 rounded-lg shadow-sm focus:ring-purple-500 focus:border-purple-500 text-lg';
                playerNameInputsContainer.appendChild(input);
            }
        }
        
        function initializeGameWithCurrentPlayers() {
            players = []; 
            if (currentTermsList.length === 0) {
                const selectedSemesterValue = semesterSelect.value;
                const selectedHkValue = hkSelect.value;
                if (selectedSemesterValue === "Zufall") {
                    Object.values(termsBySemester).forEach(semesterHks => {
                        Object.values(semesterHks).forEach(hkTerms => currentTermsList.push(...hkTerms));
                    });
                } else if (termsBySemester[selectedSemesterValue]) {
                    const semesterHks = termsBySemester[selectedSemesterValue];
                    if (!hkSelectContainer.classList.contains('hidden') && selectedHkValue === "Alle_HKs") {
                        Object.values(semesterHks).forEach(hkTerms => currentTermsList.push(...hkTerms));
                    } else if (!hkSelectContainer.classList.contains('hidden') && semesterHks[selectedHkValue]) {
                        currentTermsList = [...semesterHks[selectedHkValue]];
                    } else {
                        Object.values(semesterHks).forEach(hkTerms => currentTermsList.push(...hkTerms));
                    }
                }
                if (currentTermsList.length === 0) {
                     showMessage("Fehler: Keine Begriffe f√ºr die Auswahl gefunden. Bitte die Begriffsliste im Code pr√ºfen oder eine andere Auswahl treffen.");
                     currentWord = { term: "FEHLER", definition: "Keine Begriffe geladen." };
                     resetGame();
                     showScreen('start');
                     return; 
                }
            }
            
            currentWord = currentTermsList[Math.floor(Math.random() * currentTermsList.length)];
            imposterIndex = Math.floor(Math.random() * playerNamesForReplay.length);
            rolesRevealedCount = 0;
            
            proceedToGameBtn.classList.add('hidden'); 
            revealInfoDiv.classList.add('hidden');
            replaySamePlayersBtn.classList.add('hidden');
            revealBtn.classList.remove('hidden'); 


            playerNamesForReplay.forEach((name, index) => {
                players.push({
                    name: name,
                    isImposter: index === imposterIndex,
                    roleRevealed: false 
                });
            });
        }


        function displayPlayerCards() {
            playerCardsContainer.innerHTML = '';
            players.forEach((player, index) => {
                const cardContainer = document.createElement('div');
                cardContainer.className = 'card h-40 sm:h-44';

                const cardInner = document.createElement('div');
                cardInner.className = 'card-inner';

                const cardFront = document.createElement('div');
                cardFront.className = 'card-front flex flex-col justify-center items-center p-2';
                cardFront.innerHTML = `<span class="font-semibold text-lg">${player.name}</span><span class="text-xs mt-1">(Klicken zum Aufdecken)</span>`;

                const cardBack = document.createElement('div');
                cardBack.className = 'card-back p-3 break-words flex flex-col justify-center items-center'; 
                
                if (player.isImposter) {
                    cardBack.innerHTML = `<span class="font-bold text-xl xl:text-2xl">IMPOSTER</span><p class="text-xs mt-1">Du kennst den Begriff nicht!</p>`;
                } else {
                    const termContainer = document.createElement('div');
                    termContainer.className = 'relative group text-center w-full px-1 flex flex-col items-center justify-center h-full';

                    const termText = document.createElement('span');
                    termText.className = 'font-semibold term-text-hyphenate'; 
                    termText.textContent = currentWord.term;

                    if (currentWord.term.length > 30) {
                        termText.classList.add('text-sm');
                    } else if (currentWord.term.length > 20) {
                        termText.classList.add('text-base');
                    } else if (currentWord.term.length > 12) {
                        termText.classList.add('text-lg');
                    } else {
                        termText.classList.add('text-xl');
                    }
                    termContainer.appendChild(termText);

                    const questionMarkContainer = document.createElement('div');
                    questionMarkContainer.className = 'mt-1';

                    const questionMark = document.createElement('span');
                    questionMark.className = 'text-sm cursor-help opacity-80 hover:opacity-100';
                    questionMark.textContent = '‚ùì';
                    questionMarkContainer.appendChild(questionMark);
                    
                    const definitionBox = document.createElement('div');
                    definitionBox.className = 'definition-tooltip absolute hidden group-hover:block bg-slate-700 text-white text-xs rounded-lg p-3 shadow-xl whitespace-normal text-left';
                    definitionBox.textContent = currentWord.definition;
                    questionMarkContainer.appendChild(definitionBox);
                    
                    termContainer.appendChild(questionMarkContainer);
                    cardBack.appendChild(termContainer);
                }
                
                const understoodButton = document.createElement('button');
                understoodButton.textContent = "Verstanden";
                understoodButton.className = "absolute bottom-2 left-1/2 transform -translate-x-1/2 bg-white/20 hover:bg-white/40 text-white text-xs font-semibold py-1 px-3 rounded-md";
                understoodButton.onclick = (e) => {
                    e.stopPropagation(); 
                    cardContainer.classList.remove('flipped'); 
                    cardFront.innerHTML = `<span class="font-semibold text-lg">${player.name}</span><span class="text-sm text-green-200">‚úîÔ∏è Rolle gesehen</span>`;
                    cardContainer.onclick = null; 
                    player.roleRevealed = true;
                    rolesRevealedCount++;
                    if (rolesRevealedCount === players.length) {
                        proceedToGameBtn.classList.remove('hidden');
                    }
                };
                cardBack.appendChild(understoodButton);

                cardInner.appendChild(cardFront);
                cardInner.appendChild(cardBack);
                cardContainer.appendChild(cardInner);

                cardContainer.addEventListener('click', () => {
                    if (!cardContainer.classList.contains('flipped') && !player.roleRevealed) {
                        cardContainer.classList.add('flipped');
                    }
                });
                playerCardsContainer.appendChild(cardContainer);
            });
        }

        function determineStartingPlayer() {
            let crewmates = players.filter(p => !p.isImposter);
            if (crewmates.length === 0) { 
                if (players.length > 0) { 
                     const startingPlayer = players[Math.floor(Math.random() * players.length)];
                     startingPlayerText.textContent = `${startingPlayer.name} beginnt mit dem ersten Hinweis! (Hinweis: Konnte keinen Crewmate finden)`;
                } else {
                    startingPlayerText.textContent = "Fehler: Keine Spieler zum Starten gefunden.";
                }
                return;
            }
            const startingPlayer = crewmates[Math.floor(Math.random() * crewmates.length)];
            startingPlayerText.textContent = `${startingPlayer.name} beginnt mit dem ersten Hinweis!`;
        }

        function resetGame() {
            players = [];
            playerNamesForReplay = [];
            currentWord = { term: '', definition: '' };
            imposterIndex = -1;
            rolesRevealedCount = 0;
            currentTermsList = [];
            playerNameInputsContainer.innerHTML = '';
            playerCardsContainer.innerHTML = '';
            proceedToGameBtn.classList.add('hidden');
            semesterSelect.value = "Zufall"; 
            hkSelectContainer.classList.add('hidden');
            hkSelect.innerHTML = '';
            
            revealInfoDiv.classList.add('hidden');
            revealBtn.classList.remove('hidden'); 
            replaySamePlayersBtn.classList.add('hidden'); 
            imposterWasText.textContent = ''; 
            wordWasText.textContent = '';    
        }

        // Initial Setup
        populateSemesterSelect();
        showScreen('start');

    </script>
</body>
</html>
